import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});


const wifiFAQ = [
  {
    "question": "포켓와이파이는 몇 대까지 구매할 수 있나요?",
    "keywords": ["구매수량", "여러 대", "복수", "한도", "갯수"],
    "answer": "통신사 대여 정책상 구매 수량은 수령일과 반납일 기준으로 계산됩니다. 구매 수량이 부족하면 정상적인 주문 접수가 되지 않으니 유의해 주세요. (예: 1/1일 수령, 1/5일 반납 = 5개(일) 구매)"
  },
  {
    "question": "수령일과 반납일이 실제 사용일과 달라도 괜찮나요?",
    "keywords": ["수령일", "반납일", "사용일", "다름", "차이"],
    "answer": "사용일수에 관계없이 수령일과 반납일 기준으로 구매해주셔야 예약이 확정됩니다.\nex)2박3일 = 3개"
  },
  {
    "question": "2대 이상 복수로 구매할 수 있나요?",
    "keywords": ["2대", "복수 구매", "여러 명", "두 개", "추가 구매"],
    "answer": "아래의 방법 중 편한 방식으로 주문해주시면 됩니다.\n\n1) 예: 1/1~1/3 일정으로 2대 대여 시 → 구매 수량을 6개로 설정하고 배송(기타) 메모란에 '2대 예약'이라고 기재\n2) 2회에 걸쳐 각각 주문하고, 배송(기타) 메모란에 대여 일정 및 수령공항 정보 기재"
  },
  {
    "question": "KT 고객인데 SKT 와이파이를 사용해도 괜찮나요?",
    "keywords": ["KT", "SKT", "통신사", "사용 가능", "가입자"],
    "answer": "사용 중인 통신사에 관계없이 포켓와이파이 사용이 가능합니다."
  },
  {
    "question": "와이파이 한 대로 몇 명까지 사용할 수 있나요?",
    "keywords": ["사용 대수", "인원", "동시 접속", "몇 명", "제한"],
    "answer": "최대 5명까지 동시 사용이 가능하지만, 안정적인 속도를 위해 2~3명 사용을 권장드려요."
  },
  {
    "question": "포켓와이파이 구성품에는 어떤 것들이 포함되어 있나요?",
    "keywords": ["구성품", "내용물", "기본 제공", "포함", "케이블"],
    "answer": "상품 페이지 하단에 와이파이 본체를 포함한 전체 구성품이 안내되어 있으니 참고해 주세요."
  },
  {
    "question": "포켓와이파이는 어떻게 사용하나요?",
    "keywords": ["사용 방법", "사용법", "설치", "켜는 방법", "기기"],
    "answer": "상품 페이지 하단에 포켓와이파이 사용 설명이 상세히 안내되어 있으니 참고해 주세요."
  },
  {
    "question": "보조배터리가 포함되어 있나요?",
    "keywords": ["보조배터리", "충전기", "포함", "기본 구성", "배터리"],
    "answer": "기기 본체에 대용량(5,350mAh) 배터리가 내장되어 있으며, 완충 시 최대 15시간까지 사용 가능합니다. 별도 보조배터리는 제공되지 않습니다."
  },
  {
    "question": "국제전화나 해외 착신 기능도 사용할 수 있나요?",
    "keywords": ["국제전화", "해외 착신", "전화 가능", "기능", "음성통화"],
    "answer": "국제전화 또는 해외착신 기능이 필요하신 경우, 별도로 10일권 또는 30일권 상품을 구매하셔야 이용 가능합니다."
  },
  {
    "question": "데이터 용량이 많은 요금제는 어떤 게 있나요?",
    "keywords": ["데이터 용량", "많은", "무제한", "요금제", "속도"],
    "answer": ". SKT 바로박스: 매일 1GB 사용 후 400Kbps 속도로 무제한 사용 가능\n. KT 로밍에그: 매일 1GB 사용 후 1Mbps 속도 무제한 (※일본의 경우: 매일 5GB 사용 후 1Mbps 속도 무제한)"
  },
  {
    "question": "출국 전에 어떤 준비를 해야 하나요?",
    "keywords": ["출국 전", "준비사항", "사전 확인", "주의사항", "준비"],
    "answer": "가입된 통신사 고객센터에 연락하셔서 '데이터로밍 차단 서비스'에 가입하셔야 하며, 미가입으로 인해 발생하는 로밍 요금은 당사와 무관하니 사용에 유의해 주세요."
  },
  {
    "question": "미성년자도 포켓와이파이를 수령할 수 있나요?",
    "keywords": ["미성년자", "수령 가능", "청소년", "나이", "신분"],
    "answer": ". SKT 바로박스 예약 시 필요사항 안내드립니다.\n1. 예약자 여권(미성년) 및 예약 바우처(예약번호)\n2. 신용카드(불가: 체크카드, 하나카드, 해외발급 삼성카드, 해외발급 amex)\n3. 현장에서 카드 명의자와 통화 필요\n\n. KT 로밍에그 예약 시 안내드립니다.\n- 만 19세 미만 고객은 본인 명의 신용카드를 소지한 성인 동행이 필요하며, 단독 방문 시 KT 고객만 구비서류 지참 시 임대 가능합니다.\n(타 통신사 고객은 불가)\n- 필요 서류: 명의자 신분증, 법정대리인 신분증, 법정대리인의 동의서, 가족 증빙서류 (3개월 이내)"
  },
  {
    "question": "수령 장소와 반납 장소가 달라도 되나요?",
    "keywords": ["수령 장소", "반납 장소", "다름", "공항 변경", "편도"],
    "answer": ". SKT 바로박스: 부산항을 제외하고 교차 수령/반납이 가능합니다. 수령하실 공항을 선택하여 구매해 주세요.\n. KT 로밍에그: 교차 수령/반납이 가능합니다. 수령하실 공항을 선택하여 구매해 주세요."
  },
  {
    "question": "택배로도 포켓와이파이를 받을 수 있나요?",
    "keywords": ["택배", "배송", "수령 방법", "받기", "가능 여부"],
    "answer": "포켓와이파이 대여는 공항 또는 부산항에서 출국일에 직접 수령만 가능하며, 택배 수령은 불가합니다."
  },
  {
    "question": "공항 수령은 몇 시부터 몇 시까지 가능한가요?",
    "keywords": ["공항 수령", "운영시간", "수령 시간", "가능 시간", "시간대"],
    "answer": "인천공항은 로밍 부스에서 24시간 수령이 가능하며, 그 외 공항 및 부산항은 상품 페이지 중간의 공항별 수령 정보를 참고해 주세요."
  },
  {
    "question": "예약한 시간에 못 가면 어떻게 되나요?",
    "keywords": ["수령 못함", "방문 불가", "지연", "시간대 미도착", "예약 변경"],
    "answer": "미수령 시 고객센터로 연락 부탁드리며, 이는 당일 취소로 간주되어 1일 비용 + 배송비(5,000원)가 청구됩니다. 수령일 이후 문의 시에는 환불이 불가합니다."
  },
  {
    "question": "수령 위치를 착각해서 다른 장소로 갔어요. 어떻게 해야 하나요?",
    "keywords": ["수령 위치", "착각", "잘못된 장소", "공항", "다른 부스"],
    "answer": "구매 후 발송되는 예약 완료 문자에서 수령 위치를 반드시 확인해 주세요. 수령 위치 착각으로 인한 환불은 불가합니다."
  },
  {
    "question": "운영시간 외에 반납해도 되나요?",
    "keywords": ["운영시간 외", "반납", "야간", "시간 초과", "무인"],
    "answer": "인천공항은 로밍 부스에서 24시간 반납이 가능하며, 그 외 공항 및 부산항은 로밍 부스 인근의 무인 반납함에 반납하시면 됩니다."
  },
  {
    "question": "예정보다 일찍 반납해도 괜찮나요?",
    "keywords": ["조기 반납", "일찍 반납", "미사용", "환불", "남은 기간"],
    "answer": "대여 일정보다 조기 반납하시더라도 부분 환불은 진행되지 않으니 참고 부탁드립니다."
  },
  {
    "question": "기기 반납을 깜빡하고 집에 왔어요. 어떻게 해야 하나요?",
    "keywords": ["반납 잊음", "귀가 후", "돌려보내기", "기기 미반납", "택배 반납"],
    "answer": "고객센터로 연락해 주시고, 지연일수만큼 포켓와이파이 대여료가 부과됩니다. 기기는 택배비를 고객 부담으로 안내해드린 주소지로 발송 부탁드립니다. (예: 지연일수 × 1일 비용)"
  },
  {
    "question": "반납일이 변경되면 추가 비용이 발생하나요?",
    "keywords": ["반납일 변경", "연장", "추가 비용", "연체", "요금"],
    "answer": "고객센터로 연락해 주시면, 지연일수만큼 포켓와이파이 대여료가 부과됩니다.\n예: 지연일수 × 1일 비용"
  },
  {
    "question": "수령했는데 충전기가 없어요. 어떻게 하죠?",
    "keywords": ["충전기 없음", "누락", "구성품 부족", "케이블", "수령 이상"],
    "answer": "안드로이드폰용 5핀 충전기와 공용 사용이 가능하며, 여의치 않으실 경우 현지에서 충전기를 구매하신 후 해당 영수증을 고객센터로 보내주시면 구매 비용을 입금해 드립니다. 단, 구매하신 충전기는 파우치 안에 동봉하여 반납해 주셔야 합니다."
  },
  {
    "question": "신용카드가 없으면 포켓와이파이를 이용할 수 없나요?",
    "keywords": ["신용카드 없음", "결제 수단", "보증", "필수 여부"],
    "answer": "통신사의 대여 정책상, 수령자 본인의 신분증과 실물 신용카드가 없으면 수령이 불가능합니다."
  },
  {
    "question": "본인 명의의 신용카드가 없으면 환불 받을 수 있나요?",
    "keywords": ["신용카드 명의", "환불", "본인 명의", "결제자", "취소"],
    "answer": "일행 중 실물 신용카드를 소지한 분이 있다면, 그 분을 수령자로 변경하실 수 있습니다. 아래 정보를 회신해 주시면 수령자 정보를 변경해 드릴게요.\n\n1. 구매 시의 쇼핑몰 / 성함 / 휴대폰 번호\n2. 변경할 수령자 성함 / 휴대폰 번호"
  },
  {
    "question": "구매할 때 신용카드를 꼭 지참해야 하나요?",
    "keywords": ["신용카드 지참", "현장", "필수", "결제 수단", "소지"],
    "answer": "구매에 사용한 신용카드가 아니어도 되며, 수령자 본인의 실물 신용카드와 신분증, 수령 안내문(SKT 구매 시)을 제시하시면 수령이 가능합니다."
  },
  {
    "question": "신용카드는 어떤 용도로 필요한가요?",
    "keywords": ["신용카드 용도", "보증", "결제", "예약", "등록"],
    "answer": "통신사 로밍 부스에서 단순 확인 용도로 사용되며, 사용 기간 연장이나 와이파이 분실 등으로 추가 비용이 발생했을 때에만 결제가 진행됩니다."
  },
  {
    "question": "현장에서 신용카드 결제가 되었어요",
    "keywords": ["현장 결제", "신용카드", "결제 알림", "부스 결제", "공항"],
    "answer": "현장에서 제시한 실물 신용카드는 정상 사용 여부 확인을 위한 결제가 이루어진 후, 즉시 취소 처리됩니다."
  },
  {
    "question": "한국에서 기기를 켜면 바로 데이터가 연결되나요?",
    "keywords": ["한국에서 켜기", "데이터 연결", "작동 여부", "국내 사용"],
    "answer": "구매하신 국가에 도착해서 현지 네트워크에 접속해야 데이터 사용이 가능합니다. 국내에서는 데이터 연결은 되지 않으며, 단순히 기기가 정상 작동하는지 여부만 확인 가능합니다."
  },
  {
    "question": "한국에서 기기를 켜면 데이터가 차감되나요?",
    "keywords": ["한국", "데이터 차감", "국내 사용", "미리 켬", "용량"],
    "answer": "데이터는 현지 네트워크에 접속되어야 차감되기 때문에 국내에서 켠다고 해서 데이터가 차감되지는 않습니다. 다만, 정상 작동 여부만 확인 가능합니다."
  },
  {
    "question": "기기를 미리 켜서 테스트해도 되나요?",
    "keywords": ["미리 테스트", "사전 사용", "기기 점검", "국내 켜기"],
    "answer": "네, 기기를 미리 켜서 전원이 정상 작동하는지만 확인하셔도 괜찮습니다. 단, 국내에서는 데이터 사용은 불가합니다."
  },
  {
    "question": "요금은 어떤 기준으로 부과되나요?",
    "keywords": ["요금 기준", "부과 방식", "요금제", "일 단위", "정산"],
    "answer": "일 단위로 요금이 부과되며, 구매 수량은 수령일과 반납일 기준으로 계산해 주세요.\n(예: 1월 1일 09시 수령 ~ 1월 3일 18시 반납 → 3개(일) 구매)"
  },
  {
    "question": "중국에서 VPN 없이 구글이나 카카오톡을 사용할 수 있나요?",
    "keywords": ["중국", "VPN", "구글", "카카오톡", "접속"],
    "answer": "중국에서는 구글, 네이버, 카카오톡 등의 접속이 차단될 수 있으니, 국내에서 미리 VPN 어플을 설치하시고 출국하시길 권장드려요."
  },
  {
    "question": "데이터가 안 되거나 속도가 너무 느려요",
    "keywords": ["데이터 장애", "속도 느림", "연결 안 됨", "장애", "문제"],
    "answer": "1) 와이파이 전원을 재부팅해 주세요. (일부 기기는 배터리 탈착)\n2) 와이파이의 ID / PW를 재입력해 주세요.\n3) 그래도 문제가 지속되면 카카오톡 고객센터로 연락 주세요."
  },
  {
    "question": "진짜 데이터 무제한인가요?",
    "keywords": ["무제한", "데이터 한도", "속도제한", "용량", "정책"],
    "answer": "데이터 무제한 요금제로, 일정 데이터량을 사용한 이후에도 속도가 저하되지 않도록 설정되어 있습니다."
  },
  {
    "question": "중국에서는 구글이나 카카오톡 접속이 안 되나요?",
    "keywords": ["중국", "구글", "카카오톡", "접속 안 됨", "차단"],
    "answer": "중국 현지 인터넷 접속 규제로 인해 일부 사이트 및 앱 이용이 제한될 수 있어요. 국내에서 VPN 어플을 미리 설치해 출국하시는 걸 권장드립니다."
  },
  {
    "question": "2개국 이상에서 포켓와이파이를 사용할 수 있나요?",
    "keywords": ["2개국", "다국가", "사용 가능", "여러 나라", "이동"],
    "answer": "와이파이를 예약하신 후, 올텔 고객센터로 방문 국가를 알려주시면 다국가 사용 가능 여부를 확인해 드립니다."
  },
  {
    "question": "예약이 확정되었는지 어떻게 확인하나요?",
    "keywords": ["예약 확정", "확인 방법", "주문 확인", "완료 여부"],
    "answer": ". SKT 바로박스: 구매 당일 또는 익일 오후 6시 전후로 카카오톡 알림톡으로 수령 안내문이 발송됩니다. 해당 안내문을 참고하셔서 출국일에 선택하신 공항/부산항에서 수령하시면 됩니다.\n. KT 로밍에그: 예약 시 선택한 공항/부산항에서 수령하실 수 있도록 준비해 드립니다."
  },
  {
    "question": "포켓와이파이 사용 기간을 연장할 수 있나요?",
    "keywords": ["사용 기간", "연장", "기간 변경", "추가 사용", "반납일"],
    "answer": ". SKT 바로박스: 기존에 구매하신 쇼핑몰에서 연장 일수만큼 추가 구매 후 회신 주시면 연장 처리해 드립니다.\n. KT 로밍에그: 반납 시에 연장된 일수만큼 신용카드로 추가 결제됩니다."
  },
  {
    "question": "구매를 취소할 수 있나요?",
    "keywords": ["구매 취소", "환불", "변심", "결제 취소", "취소 방법"],
    "answer": "당일 취소 및 수령일 이후 취소는 불가합니다. 수령일 1일 전까지는 취소가 가능하며, 그 외에는 판매자가 임의로 주문을 취소할 수 없습니다. 쇼핑몰 고객센터에 연락하시어 '단순 변심 사유로 판매자와 협의 후 반품비 차감 없이 취소 신청'한다고 요청해 주시면 전액 환불로 빠르게 처리됩니다. ※ 타 사유로 접수 시 반품비가 청구될 수 있습니다."
  },
  {
    "question": "현지에서 포켓와이파이를 사용하지 못했는데 환불이 가능한가요?",
    "keywords": ["현지 사용 불가", "환불 요청", "사용 못함", "문제", "해외"],
    "answer": "현지에서 장애가 발생했을 경우 (무료) 와이파이에 접속해서 카카오톡 고객센터로 장애 증상을 접수해 주셔야 환불 처리가 가능합니다. 미접수 시에는 취소/환불이 불가합니다."
  }

  ];

export async function callGPTWithFAQ_wifi(userInput) {
  const faqTextBlock = wifiFAQ
    .map(
      (f, i) => `#${i + 1}\nQ: ${f.question}\nK: ${f.keywords.join(', ')}\nA: ${f.answer}`
    )
    .join('\n\n');

  const messages = [
    {
  role: "system",
  content: `
당신은 해외 유심 및 포켓와이파이를 판매하는 올텔의 고객센터 상담사입니다.
고객이 입력한 질문을 친절하고 신뢰감 있게 이해하고 답변해 주세요.

- 아래는 자주 묻는 질문(FAQ)입니다. 질문에 직접적인 답변이 없더라도, 관련된 내용을 참고하거나 유추해서 도와주세요.
- 질문이 불분명하거나 정보가 부족하면, 공손하게 추가 정보를 요청하세요.
- 가능한 경우에는 고객이 원할 답을 예측해서 설명하고, 정말 필요한 경우에만 고객센터 안내를 해주세요.
- 답변은 자연스럽고 공손한 말투로 제공해 주세요.

아래는 참고용 FAQ입니다:
${faqTextBlock}
`
},
    {
      role: "user",
      content: userInput
    }
  ];

  const chat = await openai.chat.completions.create({
    model: "gpt-4o",
    messages
  });

  return chat.choices[0].message.content;
}